import{r,b as c,j as e,c as T,R as G}from"./assets/chunks/browser-api.DVdZh9D_.js";const P=["ShiftLeft","ShiftRight","ControlLeft","ControlRight","AltLeft","AltRight","MetaLeft","MetaRight","F1","F2","F3","F4","F5","F6","F7","F8","F9","F10","F11","F12","KeyA","KeyB","KeyC","KeyD","KeyE","KeyF","KeyG","KeyH","KeyI","KeyJ","KeyK","KeyL","KeyM","KeyN","KeyO","KeyP","KeyQ","KeyR","KeyS","KeyT","KeyU","KeyV","KeyW","KeyX","KeyY","KeyZ","Digit0","Digit1","Digit2","Digit3","Digit4","Digit5","Digit6","Digit7","Digit8","Digit9","ArrowUp","ArrowDown","ArrowLeft","ArrowRight"];function W(n){return P.includes(n)}function g(n){const s={ShiftLeft:"Left Shift",ShiftRight:"Right Shift",ControlLeft:"Left Ctrl",ControlRight:"Right Ctrl",AltLeft:"Left Alt",AltRight:"Right Alt",MetaLeft:"Left Cmd",MetaRight:"Right Cmd",ArrowUp:"‚Üë",ArrowDown:"‚Üì",ArrowLeft:"‚Üê",ArrowRight:"‚Üí"};return s[n]?s[n]:n.startsWith("F")&&n.length<=3?n:n.startsWith("Key")?n.slice(3):n.startsWith("Digit")?n.slice(5):n}class ${isCapturing=!1;timeoutId=null;options;constructor(s){this.options=s}startCapture(){this.isCapturing||(this.isCapturing=!0,this.options.timeout&&(this.timeoutId=window.setTimeout(()=>{this.cancelCapture()},this.options.timeout)),document.addEventListener("keydown",this.handleKeyDown,!0),document.addEventListener("keydown",this.preventDefault,!0))}cancelCapture(){this.isCapturing&&(this.isCapturing=!1,this.timeoutId&&(clearTimeout(this.timeoutId),this.timeoutId=null),document.removeEventListener("keydown",this.handleKeyDown,!0),document.removeEventListener("keydown",this.preventDefault,!0),this.options.onCancel?.())}handleKeyDown=s=>{if(!this.isCapturing)return;const l=s.code;W(l)&&(this.cancelCapture(),this.options.onKeyCaptured(l))};preventDefault=s=>{this.isCapturing&&(s.preventDefault(),s.stopPropagation())}}const U=n=>n.reduce((s,l)=>((s[l.category]??=[]).push(l),s),{});function _(){const[n,s]=r.useState([]),[l,y]=r.useState({}),[f,x]=r.useState(!0),[b,v]=r.useState(null),[V,K]=r.useState(!1),[S,w]=r.useState(!1),[d,p]=r.useState({activationKey:"ShiftLeft",endKey:"ControlLeft",toggleMode:!1,dedupe:!0,deepResolve:!0,grabDelay:500,effects:!0,highlightColor:"#4CAF50",notifyDuration:2e3}),[u,m]=r.useState(null),a=t=>{v(t),setTimeout(()=>v(null),2e3)},N=async(t=!1)=>{t&&K(!0);try{const o=await c.getGrabbedLinks();s(o),y(U(o)),x(!1),t&&a(`Refreshed - ${o.length} links`)}catch{s([]),y({}),x(!1),t&&a("No links found")}finally{t&&K(!1)}};r.useEffect(()=>{N(),D()},[]);const D=async()=>{try{const t=await c.getSettings();p(t)}catch{}},L=async()=>{try{await c.setSettings(d),a("Settings saved!")}catch{a("Failed to save settings")}},z=async()=>{const t={activationKey:"ShiftLeft",endKey:"ControlLeft",toggleMode:!1,dedupe:!0,deepResolve:!0,grabDelay:500,effects:!0,highlightColor:"#4CAF50",notifyDuration:2e3};p(t);try{await c.setSettings(t),a("Settings reset to defaults!")}catch{a("Failed to reset settings")}},C=t=>{m(t),new $({onKeyCaptured:i=>{p(t==="activation"?h=>({...h,activationKey:i}):h=>({...h,endKey:i})),m(null),a(`Key captured: ${g(i)}`)},onCancel:()=>{m(null)},timeout:1e4}).startCapture()},A=async()=>{n.length&&(await navigator.clipboard.writeText(n.map(t=>t.normalized).join(`
`)),a(`Copied ${n.length} link${n.length>1?"s":""}`))},R=async()=>{if(n.length)try{await c.sendMessage({type:"DOWNLOAD_URLS",payload:{urls:n.map(t=>t.normalized)}}),a("Download started")}catch{a("Download failed")}},F=async t=>{await navigator.clipboard.writeText(t),a("Copied")},k=async t=>{try{await c.sendMessage({type:"DOWNLOAD_URLS",payload:{urls:[t]}}),a("Downloading...")}catch{a("Download failed")}},M=async(t,o)=>{y(i=>{const h={...i,[t]:i[t]?.filter(O=>O.id!==o)||[]},j=Object.values(h).flat();return s(j),c.storeGrabbedLinks(j),h})},E=()=>e.jsxs(e.Fragment,{children:[e.jsx("button",{className:"top-2 right-2 absolute bg-zinc-800 rounded hover:bg-zinc-700 px-2 py-1",onClick:()=>w(!0),children:"‚öôÔ∏è"}),e.jsxs("div",{className:"mx-3 my-3 flex flex-wrap justify-between",children:[e.jsx("button",{onClick:A,className:"px-3 py-1 bg-red-600 rounded hover:bg-red-700",children:"Copy All"}),e.jsx("button",{onClick:R,className:"px-3 py-1 bg-red-600 rounded hover:bg-red-700",children:"Download All"})]}),e.jsx("div",{className:"space-y-4 max-h-[420px] overflow-auto pr-1",children:Object.entries(l).map(([t,o])=>e.jsxs("div",{children:[e.jsx("div",{className:"text-sm text-zinc-400 mb-1 uppercase tracking-wide",children:t}),e.jsx("div",{className:"space-y-2",children:o.map(i=>e.jsxs("div",{className:"p-2 bg-zinc-800 rounded flex justify-between items-center hover:bg-zinc-900 transition",children:[e.jsx("a",{className:"text-sm break-all flex-1",href:i.normalized,target:"_blank",rel:"noreferrer",children:i.normalized}),e.jsxs("div",{className:"ml-2 flex gap-2 shrink-0 flex-col",children:[e.jsx("button",{className:"text-2xs px-[0.75] py-[0.75] bg-zinc-800 rounded hover:bg-zinc-700",onClick:()=>F(i.normalized),children:"üìé"}),e.jsx("button",{className:"text-2xs px-[0.75] py-[0.75] bg-zinc-800 rounded hover:bg-zinc-700",onClick:()=>k(i.normalized),children:"‚¨áÔ∏è"}),e.jsx("button",{className:"text-2xs px-[0.75] py-[0.75] bg-zinc-800 rounded hover:bg-zinc-700",onClick:()=>M(i.category,i.id),children:"‚ùå"})]})]},i.id))})]},t))}),!f&&n.length===0&&e.jsxs("div",{className:"text-center",children:[e.jsx("div",{className:"text-zinc-500 mb-3",children:"No links captured yet."}),e.jsxs("div",{className:"text-zinc-400 text-sm mb-3",children:["Hold ",g(d.activationKey)," to capture links, then ",g(d.activationKey),"+",g(d.endKey)," to save them here."]})]})]}),I=()=>e.jsxs(e.Fragment,{children:[e.jsx("button",{className:"top-2 right-2 absolute bg-zinc-800 rounded hover:bg-zinc-700 px-2 py-1",onClick:()=>w(!1),children:"üè†"}),e.jsxs("div",{className:"space-y-4 max-h-[420px] overflow-auto pr-1",children:[e.jsxs("div",{className:"space-y-3",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm text-zinc-400 mb-2",children:"Activation Key"}),e.jsx("button",{className:`w-full p-3 rounded text-left ${u==="activation"?"bg-yellow-600 hover:bg-yellow-700":"bg-zinc-800 hover:bg-zinc-700"}`,onClick:()=>C("activation"),disabled:u!==null,children:u==="activation"?"Press any key...":g(d.activationKey)})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm text-zinc-400 mb-2",children:"End Key (open popup)"}),e.jsx("button",{className:`w-full p-3 rounded text-left ${u==="end"?"bg-yellow-600 hover:bg-yellow-700":"bg-zinc-800 hover:bg-zinc-700"}`,onClick:()=>C("end"),disabled:u!==null,children:u==="end"?"Press any key...":g(d.endKey)})]})]}),e.jsxs("div",{className:"flex gap-2 pt-4",children:[e.jsx("button",{className:"flex-1 px-3 py-2 bg-red-600 rounded hover:bg-red-700",onClick:L,children:"Save"}),e.jsx("button",{className:"flex-1 px-3 py-2 bg-zinc-700 rounded hover:bg-zinc-600",onClick:z,children:"Reset"})]})]})]});return e.jsxs("div",{className:"p-4 bg-zinc-900 min-w-[360px] text-white font-mono relative",children:[e.jsx("h2",{className:"text-lg text-red-500 mb-3 font-semibold",children:"MagnoGrabr"}),b&&e.jsx("div",{className:"absolute top-2 left-1/2 transform -translate-x-1/2 bg-zinc-800 text-sm px-3 py-1 rounded shadow-lg animate-fadeIn",children:b}),f&&e.jsx("div",{className:"text-zinc-400",children:"Loading‚Ä¶"}),!f&&(S?I():E())]})}T.createRoot(document.getElementById("root")).render(e.jsx(G.StrictMode,{children:e.jsx(_,{})}));
